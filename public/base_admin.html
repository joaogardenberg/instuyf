<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instuyf de Spuyt — Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: 'media' }
    </script>
    <style>
      .dark input[type='date'],
      .dark input[type='time'] {
        color-scheme: dark;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React

      // ─── Helpers ────────────────────────────────────────────────────────────────

      function formatDate(dateStr) {
        const d = new Date(dateStr + 'T00:00:00')
        return d.toLocaleDateString('en-NL', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        })
      }

      function toInputDate(date) {
        return date.toISOString().split('T')[0]
      }

      function generateId() {
        return Math.random().toString(36).slice(2, 9)
      }

      // ─── Mock data (descending by date) ─────────────────────────────────────────

      function generateMockEvents() {
        const now = new Date()
        // Build 6 upcoming Mondays
        const mondays = []
        const d = new Date(now)
        const day = d.getDay()
        const diff = (1 - day + 7) % 7 || 7
        d.setDate(d.getDate() + diff)
        d.setHours(0, 0, 0, 0)
        for (let i = 0; i < 6; i++) {
          mondays.push(new Date(d))
          d.setDate(d.getDate() + 7)
        }

        // Return in descending order: mondays[5] first, mondays[0] last
        return [
          {
            id: generateId(),
            date: toInputDate(mondays[5]),
            time: '20:00',
            paymentUrl: 'https://tikkie.me/pay/example',
            maxRegistrants: 14
          },
          {
            id: generateId(),
            date: toInputDate(mondays[4]),
            time: '19:30',
            paymentUrl: 'https://tikkie.me/pay/example3',
            maxRegistrants: 30
          },
          {
            id: generateId(),
            date: toInputDate(mondays[3]),
            time: '20:00',
            paymentUrl: 'https://tikkie.me/pay/example',
            maxRegistrants: 14
          },
          {
            id: generateId(),
            date: toInputDate(mondays[2]),
            time: '20:30',
            paymentUrl: 'https://tikkie.me/pay/example2',
            maxRegistrants: 20
          },
          {
            id: generateId(),
            date: toInputDate(mondays[1]),
            time: '20:00',
            paymentUrl: 'https://tikkie.me/pay/example',
            maxRegistrants: 14
          },
          {
            id: generateId(),
            date: toInputDate(mondays[0]),
            time: '20:00',
            paymentUrl: 'https://tikkie.me/pay/example',
            maxRegistrants: 14
          }
        ]
      }

      const PAGE_SIZE = 5

      const EMPTY_FORM = {
        date: '',
        time: '20:00',
        paymentUrl: '',
        maxRegistrants: 14
      }

      // ─── Icons ──────────────────────────────────────────────────────────────────

      function TrashIcon() {
        return (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            className="w-4 h-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <polyline points="3 6 5 6 21 6" />
            <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" />
            <path d="M10 11v6" />
            <path d="M14 11v6" />
            <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2" />
          </svg>
        )
      }

      function PencilIcon() {
        return (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            className="w-4 h-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
          </svg>
        )
      }

      function ChevronLeftIcon() {
        return (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            className="w-4 h-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <polyline points="15 18 9 12 15 6" />
          </svg>
        )
      }

      function ChevronRightIcon() {
        return (
          <svg
            xmlns="http://www.w3.org/2000/svg"
            className="w-4 h-4"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <polyline points="9 18 15 12 9 6" />
          </svg>
        )
      }

      // ─── Form ────────────────────────────────────────────────────────────────────

      function EventForm({ initial, onSave, onCancel }) {
        const [form, setForm] = useState(initial || EMPTY_FORM)
        const [errors, setErrors] = useState({})

        function set(field, value) {
          setForm((f) => ({ ...f, [field]: value }))
          setErrors((e) => ({ ...e, [field]: undefined }))
        }

        function validate() {
          const e = {}
          if (!form.date) e.date = 'Date is required.'
          if (!form.time) e.time = 'Time is required.'
          if (!form.paymentUrl.trim()) e.paymentUrl = 'Payment URL is required.'
          if (!form.maxRegistrants || form.maxRegistrants < 1)
            e.maxRegistrants = 'Must be at least 1.'
          return e
        }

        function handleSave() {
          const e = validate()
          if (Object.keys(e).length > 0) {
            setErrors(e)
            return
          }
          onSave(form)
        }

        const labelCls =
          'block text-xs font-semibold uppercase tracking-widest text-gray-400 dark:text-gray-500 mb-1'
        const inputCls =
          'w-full bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 rounded-lg px-3 py-2 text-sm outline-none focus:border-purple-500 transition'
        const errCls = 'text-red-500 text-xs mt-1'

        return (
          <div className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-6">
            <h2 className="text-lg font-bold mb-4">
              {initial ? 'Edit event' : 'Create event'}
            </h2>
            <div className="grid grid-cols-1 gap-4 sm:grid-cols-2">
              <div>
                <label className={labelCls}>Date</label>
                <input
                  type="date"
                  value={form.date}
                  onChange={(e) => set('date', e.target.value)}
                  className={inputCls}
                />
                {errors.date && <p className={errCls}>{errors.date}</p>}
              </div>
              <div>
                <label className={labelCls}>Time</label>
                <input
                  type="time"
                  value={form.time}
                  onChange={(e) => set('time', e.target.value)}
                  className={inputCls}
                />
                {errors.time && <p className={errCls}>{errors.time}</p>}
              </div>
              <div>
                <label className={labelCls}>Max registrants</label>
                <input
                  type="number"
                  min="1"
                  value={form.maxRegistrants}
                  onChange={(e) =>
                    set('maxRegistrants', parseInt(e.target.value) || '')
                  }
                  className={inputCls}
                />
                {errors.maxRegistrants && (
                  <p className={errCls}>{errors.maxRegistrants}</p>
                )}
              </div>
              <div className="sm:col-span-2">
                <label className={labelCls}>Payment URL</label>
                <input
                  type="url"
                  value={form.paymentUrl}
                  onChange={(e) => set('paymentUrl', e.target.value)}
                  placeholder="https://tikkie.me/pay/..."
                  className={inputCls}
                />
                {errors.paymentUrl && (
                  <p className={errCls}>{errors.paymentUrl}</p>
                )}
              </div>
            </div>
            <div className="flex justify-end gap-2 mt-6">
              <button
                onClick={onCancel}
                className="select-none px-4 py-2 text-sm font-semibold rounded-lg border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer"
              >
                Cancel
              </button>
              <button
                onClick={handleSave}
                className="select-none px-4 py-2 text-sm font-semibold rounded-lg bg-purple-100 dark:bg-purple-700 hover:bg-purple-200 dark:hover:bg-purple-800 text-purple-800 dark:text-white transition-colors cursor-pointer"
              >
                {initial ? 'Save changes' : 'Create event'}
              </button>
            </div>
          </div>
        )
      }

      // ─── Event row ────────────────────────────────────────────────────────────────

      function EventRow({ event, onEdit, onDelete }) {
        return (
          <div className="flex items-center gap-3 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
            <div className="flex-1 min-w-0">
              <p className="text-sm font-semibold truncate">
                {formatDate(event.date)} · {event.time}
              </p>
              <p className="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
                max {event.maxRegistrants}
              </p>
            </div>
            <div className="flex gap-1 flex-shrink-0">
              <button
                onClick={onEdit}
                title="Edit"
                className="select-none text-purple-400 dark:text-purple-300 hover:text-white dark:hover:text-white hover:bg-purple-600 rounded-md p-1.5 transition-all opacity-60 hover:opacity-100 cursor-pointer"
              >
                <PencilIcon />
              </button>
              <button
                onClick={onDelete}
                title="Delete"
                className="select-none text-red-400 hover:text-white dark:hover:text-red-100 hover:bg-red-500 rounded-md p-1.5 transition-all opacity-60 hover:opacity-100 cursor-pointer"
              >
                <TrashIcon />
              </button>
            </div>
          </div>
        )
      }

      // ─── Delete modal ─────────────────────────────────────────────────────────────

      function DeleteModal({ event, onConfirm, onCancel }) {
        return (
          <div className="fixed inset-0 bg-black/40 flex items-center justify-center z-50 px-4">
            <div className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 max-w-sm w-full shadow-xl">
              <h2 className="text-lg font-bold mb-2">Delete event?</h2>
              <p className="text-sm text-gray-500 dark:text-gray-400 mb-6">
                Are you sure you want to delete the event on{' '}
                <span className="font-semibold text-gray-900 dark:text-gray-100">
                  {formatDate(event.date)}
                </span>
                ? This cannot be undone.
              </p>
              <div className="flex justify-end gap-2">
                <button
                  onClick={onCancel}
                  className="select-none px-4 py-2 text-sm font-semibold rounded-lg border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors cursor-pointer"
                >
                  Cancel
                </button>
                <button
                  onClick={onConfirm}
                  className="select-none px-4 py-2 text-sm font-semibold rounded-lg bg-red-500 hover:bg-red-600 text-white transition-colors cursor-pointer"
                >
                  Delete
                </button>
              </div>
            </div>
          </div>
        )
      }

      // ─── App ──────────────────────────────────────────────────────────────────────

      function App() {
        const [events, setEvents] = useState(generateMockEvents)
        const [page, setPage] = useState(0)
        const [view, setView] = useState('list')
        const [editingEvent, setEditingEvent] = useState(null)
        const [deletingEvent, setDeletingEvent] = useState(null)

        const totalPages = Math.ceil(events.length / PAGE_SIZE)
        const pageEvents = events.slice(
          page * PAGE_SIZE,
          page * PAGE_SIZE + PAGE_SIZE
        )

        function handleCreate(form) {
          setEvents((prev) => [...prev, { ...form, id: generateId() }])
          setView('list')
        }

        function handleEdit(form) {
          setEvents((prev) =>
            prev.map((e) =>
              e.id === editingEvent.id ? { ...form, id: e.id } : e
            )
          )
          setEditingEvent(null)
          setView('list')
        }

        function handleDelete() {
          setEvents((prev) => {
            const next = prev.filter((e) => e.id !== deletingEvent.id)
            const newTotal = Math.ceil(next.length / PAGE_SIZE)
            if (page >= newTotal && page > 0) setPage(page - 1)
            return next
          })
          setDeletingEvent(null)
        }

        return (
          <div className="min-h-screen bg-purple-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300 py-8 px-4">
            <div className="max-w-xl mx-auto mb-6">
              <h1 className="text-3xl font-bold tracking-tight">
                Instuyf de Spuyt
              </h1>
              <p className="text-sm text-gray-500 dark:text-gray-400 mt-0.5">
                Event management
              </p>
            </div>

            <div className="max-w-xl mx-auto">
              {view === 'list' && (
                <div className="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-6 mb-4">
                  <div className="flex items-center justify-between mb-4">
                    <h2 className="text-base font-bold">
                      Events{' '}
                      <span className="text-gray-400 dark:text-gray-500 font-normal text-sm">
                        ({events.length})
                      </span>
                    </h2>
                    <button
                      onClick={() => setView('create')}
                      className="select-none px-4 py-2 text-sm font-semibold rounded-lg bg-purple-100 dark:bg-purple-700 hover:bg-purple-200 dark:hover:bg-purple-800 text-purple-800 dark:text-white transition-colors cursor-pointer"
                    >
                      + Create event
                    </button>
                  </div>

                  {events.length === 0 ? (
                    <p className="text-sm text-center text-gray-400 dark:text-gray-500 py-6">
                      No events yet. Create one!
                    </p>
                  ) : (
                    <div className="flex flex-col gap-2">
                      {pageEvents.map((event) => (
                        <EventRow
                          key={event.id}
                          event={event}
                          onEdit={() => {
                            setEditingEvent(event)
                            setView('edit')
                          }}
                          onDelete={() => setDeletingEvent(event)}
                        />
                      ))}
                    </div>
                  )}

                  {totalPages > 1 && (
                    <div className="flex items-center justify-between mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                      <button
                        onClick={() => setPage((p) => Math.max(0, p - 1))}
                        disabled={page === 0}
                        className="select-none flex items-center gap-1 px-3 py-1.5 text-sm font-medium rounded-lg border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-30 disabled:cursor-default transition-colors cursor-pointer"
                      >
                        <ChevronLeftIcon /> Previous
                      </button>
                      <span className="text-sm text-gray-500 dark:text-gray-400">
                        Page {page + 1} of {totalPages}
                      </span>
                      <button
                        onClick={() =>
                          setPage((p) => Math.min(totalPages - 1, p + 1))
                        }
                        disabled={page === totalPages - 1}
                        className="select-none flex items-center gap-1 px-3 py-1.5 text-sm font-medium rounded-lg border border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-30 disabled:cursor-default transition-colors cursor-pointer"
                      >
                        Next <ChevronRightIcon />
                      </button>
                    </div>
                  )}
                </div>
              )}

              {view === 'create' && (
                <EventForm
                  onSave={handleCreate}
                  onCancel={() => setView('list')}
                />
              )}

              {view === 'edit' && editingEvent && (
                <EventForm
                  initial={editingEvent}
                  onSave={handleEdit}
                  onCancel={() => {
                    setEditingEvent(null)
                    setView('list')
                  }}
                />
              )}
            </div>

            {deletingEvent && (
              <DeleteModal
                event={deletingEvent}
                onConfirm={handleDelete}
                onCancel={() => setDeletingEvent(null)}
              />
            )}

            <p className="text-center text-xs text-gray-400 dark:text-gray-600 mt-8">
              Instuyf de Spuyt · No backend yet — data resets on reload.
            </p>
          </div>
        )
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />)
    </script>
  </body>
</html>
